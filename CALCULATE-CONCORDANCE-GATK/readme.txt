### [[Introduction (Version 2.2.0)]] ###

calc_concor is a bash script tool developed based on unix commands, BCFtools, and GATK. Its main function is to calculate the reference and non-reference genotype concordance between two VCF files based on user-specified INFO intervals (e.g., AF) and output statistical data. Users can customize parameters to better adapt to their research direction and content.

### [[Inputs and Outputs (Version 2.2.0)]] ###

The calc_concor tool requires only two .vcf/.vcf.gz files as input to operate. Whether the target files are compressed does not affect the final outcome nor alter any filenames, as their suffixes will be automatically removed. Additionally, should these two files not be indexed, the tool will automatically detect this and assist in indexing them. It is imperative to note that each file must contain only one sample, and these two samples must be comparable. Within these two VCF files, one is designated as the true sample, and the other as the call sample. It is crucial to understand that the definitions of true sample and call sample will influence the statistical outcomes, as they affect the calculations of True Positive, True Negative, False Positive, and False Negative. For detailed explanations of the calculation process and principles, please refer to the official GATK documentation listed in the resources section.

All results will be saved in two folders: one suffixed with GATK and the other without the GATK suffix. The name of the folder depends on the names of the user's true sample and call sample. The GATK folder contains the original results of applying GATK GenotypeConcordance (Picard) to the user's two files, generating three files for each INFO interval comparison. For an explanation of these files, refer to the GATK official documents listed in the resources section.

The folder without the GATK suffix contains the final output results, which is a .tsv report containing the following columns:

 1. VAR_TYPE: The type of variant, a string.
 2. INFO_INTERVAL: The specified INFO interval. For example, if the INFO is AF, it would be AF_INTERVAL, a string.
 3. G_CONCORDANCE: The overall genotype concordance, including situations where the genotype sites in both files are reference (homozygous reference, 0/0), calculated as (TP + TN) / (TP + TN + FP + FN), a floating-point number.
 4. NON_REF_G_CONCORDANCE: The non-reference genotype concordance, excluding situations where the genotype sites in both files are reference (homozygous reference, 0/0), calculated as TP / (TP + FP + FN), a floating-point number.

### [[Modules Required (Version 2.2.0)]] ###

This tool relies on a Unix/Linux operating environment and requires specific versions of the following tools:

 - bcftools/1.15.1
 - bz2/1.0.6
 - gsl/2.5
 - GATK/4.2.1.0

Using different versions of the above tools may result in output filenames not matching the expected results (depending on whether the tool developers have changed their output items) and affect the running process of the bash script.

### [[Customizable Parameters (Version 2.2.0)]] ###

 1. compare_sample: Equivalent to GATK tool's call_sample, the .vcf/.vcf.gz file to compare.
 2. true_sample: Equivalent to GATK tool's truth_sample, the .vcf/.vcf.gz file containing the cross-validated truth set.
 3. target_bin_info: The filtering interval to select, must be a string, and it must genuinely exist under the .vcf file's INFO, e.g., AF or RAF.
 4. reference_file: The specified location of the reference file, can be empty. Cannot be empty when add_reference_file is set to true.
 5. delete_intermediate_files: Defaults to true, which will delete all intermediate files generated by filtering INFO intervals. Must be a boolean value. When set to false, retains all intermediate files.
 6. add_reference_file: Defaults to false, when set to true, GATK will use the user-specified reference_file as the reference file.
 7. WORK_DIR: The overall working path.
 8. COMPARE_DIR: The path for intermediate files of the compare_sample filtered by INFO, by default stored under WORK_DIR.
 9. TRUE_DIR: The path for intermediate files of the true_sample filtered by INFO, by default stored under WORK_DIR.
 10. GATK_CONCORDANCE_DIR: The path for storing concordance files calculated by GATK, by default stored under WORK_DIR.
 11. CONCORDANCE_DIR: The path for storing the final calculated concordance files, by default stored under WORK_DIR.
 12. declare -a intervals: The specified INFO interval fields. The format must strictly follow this example: declare -a intervals=("0-0.01" "0.01-0.02" "0.02-0.05" "0.05-0.1" "0.1-0.2" "0.2-0.5" "0.5-1"). 

### [[Update Log]] ###

 - Version V1.0.0 (calc_concor_v1_0_0.bash): The initial version of this tool, which relies on GATK to preliminarily calculate the non-reference concordance.
 - Version V2.0.0 (calc_concor_v2_0_0.bash): Added the calculation for cases where the genotype loci in both files are reference (homozygous reference, 0/0).
 - Version V2.1.0 (calc_concor_v2_1_0.bash): Added the add_reference_file parameter, allowing users to decide whether to use a reference file.
 - Version V2.2.0 (calc_concor_v2_2_0.bash): Added the welcome message and version number. Added detection for the success or failure of the GATK section and the final results calculation, providing users with more information.

### [[Acknowledgements]] ###

I sincerely appreciate the guidance and contributions of Dr. Or Yaacov in the conceptualization, development, and debugging of this tool. Additionally, I am grateful for the opportunity to work under Dr. Aravinda Chakravarti and his lab. Lastly, I thank the High Performance Computing Core (HPCC) facility at NYU Langone for their support with computational resources.

### [[References]] ###

 1. Danecek P, Bonfield JK, et al. Twelve years of SAMtools and BCFtools. Gigascience (2021) 10(2): giab008.
 2. Danecek P, McCarthy SA. BCFtools/csq: Haplotype-aware variant consequences. Bioinformatics (2017) 33(13): 2037-39.
 3. Danecek P, McCarthy SA, HipSci Consortium, and Durbin R. A Method for Checking Genomic Integrity in Cultured Cell Lines from SNP Genotyping Data, PLoS One (2016) 11(5): e0155014.
 4. Li H. A statistical framework for SNP calling, mutation discovery, association mapping and population genetical parameter estimation from sequencing data. Bioinformatics (2011) 27(21): 2987-93.
 5. Li H. Improving SNP discovery by base alignment quality. Bioinformatics (2011) 27(8):1157-8.
 6. Narasimhan V, Danecek P, Scally A, Xue Y, Tyler-Smith C, and Durbin R. BCFtools/RoH: a hidden Markov model approach for detecting autozygosity from next-generation sequencing data. Bioinformatics (2016) 32(11): 1749-51.
 7. Van der Auwera GA & O'Connor BD. (2020). Genomics in the Cloud: Using Docker, GATK, and WDL in Terra (1st Edition). O'Reilly Media.

### [[Resources]] ###

 1. BCFtools GitHub website: http://github.com/samtools/bcftools
 2. Samtools GitHub website: http://github.com/samtools/samtools
 3. HTSlib GitHub website: http://github.com/samtools/htslib
 4. File format specifications: http://samtools.github.io/hts-specs
 5. BCFtools documentation: http://samtools.github.io/bcftools
 6. BCFtools wiki page: https://github.com/samtools/bcftools/wiki
 7. GATK GenotypeConcordance (Picard) user guide: https://gatk.broadinstitute.org/hc/en-us/articles/360037591611-GenotypeConcordance-Picard

### [[Copyright]] ###

This tool was independently developed by Baiqi Jiang, under the guidance of Dr. Or Yaacov, and is only authorized for use and modification by the Chakravarti Lab. The copyrights of BCFtools and GATK still belong to their declared individuals or organizations, not the aforementioned three. The citation for these two tools is noted in the references section.

If you are not the author, guide, or a member of the Chakravarti Lab and wish to use this tool, please apply to the above three for usage rights and/or modification rights. Any actions including but not limited to use, modification, and forwarding without the certification of the author, guide, and Chakravarti Lab will be considered plagiarism and copyright infringement, and the aforementioned three reserve the right to pursue legal actions against individuals or organizations performing such actions. Furthermore, any form of use of this tool must include citations for the above three and for BCFtools and GATK.

### [[Contact Info]] ###

If you have issues that cannot be resolved after consulting the user manuals provided in the resources section, or if you wish to request tool upgrades and subsequent development, please contact:

Baiqi Jiang | MSc in Biomed. Informa.
NYU Grossman School of Medicine
Mystery Writers of America
Cerulean Deer Studio

CELL/TEXT: 857-348-7988
Baiqi.Jiang@nyulangone.org
bj2349@nyu.edu
baiqi@bu.edu (Preferred)
k4tzvic@gmail.com
